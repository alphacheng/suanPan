language: cpp
compiler: gcc
git:
  depth: false
branches:
  except:
    - /^suanPan/
matrix:
  include:
    - os: osx
      before_script:
        - export SP_TIME=suanPan-daily-$(date +''%Y%m%d%H'')
        - export CC=gcc-9
        - export CXX=g++-9
        - export FC=gfortran-9
      script:
        - mkdir cmake-build-release && cd cmake-build-release
        - cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_MULTITHREAD=ON -DUSE_HDF5=ON ../
        - make -j4
      after_success:
        - cd ../
        - mkdir suanPan-macos-openblas
        - cp cmake-build-release/suanPan suanPan-macos-openblas
        - cp Libs/gcc-mac/libtbb.dylib suanPan-macos-openblas
        - cp Libs/gcc-mac/libtbbmalloc.dylib suanPan-macos-openblas
        - cp Libs/gcc-mac/libtbbmalloc_proxy.dylib suanPan-macos-openblas
        - cp LICENSE suanPan-macos-openblas
        - cp README.md suanPan-macos-openblas
        - cp CHANGELOG.md suanPan-macos-openblas
        - cp Enhancement/suanPan.sh suanPan-macos-openblas
        - cp Enhancement/suanPan.sublime-syntax suanPan-macos-openblas
        - cp Enhancement/suanPan.sublime-completions suanPan-macos-openblas
        - tar cvzf suanPan-macos-openblas.tar.gz suanPan-macos-openblas
      before_deploy:
        - git tag $SP_TIME
      deploy:
        provider: releases
        token:
          secure: dedjpKamteQHzhU18Ejc8UiNnaFemNwk28Og/d52tzWh9MUin9gE6SMoxiGfnczuyDqolMyWTtcMt4fDAoO8NK+cd4HlB/NKurjZXjRk+eq23FkyAR63DL3QL9qKPUUDzR9Hbn8897Xm8HRcoKKr8YSfeIBUIn6YQqQOPX1aLXsrlhS6i3AwCPOpUB0bJyslOm6r0+N059mNsnumuh2mOnFpXCYhcZiCAHTcIZDtb0y5OAei+e2QPekbz2wX4L7q+YCCbWPCJwJnVmynXiOBdSbjABTy0+RQfWvu+QP4TgY1dvUpPnK3V5mQEtCCVFVRkGhfH8Cvpvzdtvlgpg2gWSAQ1aEzKKbGy59vnNkoHOM918t6mIKpmM92XNUJBJGWxkXdnfNbVG/l07UsVUiygQr5mEXW+Ybj3rLTAqs1yQWq7dWD276n9V9jQ7bzyhF35Y+x8KKMM0DuGvWc5iCoyrhanUix246kshim9QG0zFjpgOzVpCD6NTS5NNeZ3WeM4umcfhe0QGM277uuuiiCIqkAtwWMujY1HEKK57qhmjXguxiu00rgicFpiCQ3CmTs5jQ6miqn9ePmZcZUpJJ9gLNSxwsnpVD/MqxblD7IpRjVwxlr/FUMicBApvHkRGUFAcR1ik66lcuh3LIqDSopKPN1dR66VPH5RDOUSUm9aJs=
        file: suanPan-macos-openblas.tar.gz
        overwrite: true
        skip_cleanup: true
        name: $SP_TIME
notifications:
  email: false
